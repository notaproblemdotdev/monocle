---
phase: 03-dashboard-ui
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/monocli/ui/sections.py
  - src/monocli/ui/main_screen.py
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "Pressing 'o' key opens the selected item in the default browser"
    - "Keyboard navigation works in the currently focused section after Tab switching"
    - "Pressing 'q' key quits the application"
  artifacts:
    - path: "src/monocli/ui/sections.py"
      provides: "Fixed get_selected_url() methods in both MergeRequestSection and WorkItemSection"
      changes:
        - "MergeRequestSection.get_selected_url() accesses row_key.value"
        - "WorkItemSection.get_selected_url() accesses row_key.value"
    - path: "src/monocli/ui/main_screen.py"
      provides: "Fixed focus switching and added quit binding"
      changes:
        - "Line 264: self.work_section.focus() -> self.work_section.focus_table()"
        - "BINDINGS includes ('q', 'quit', 'Quit')"
  key_links:
    - from: "src/monocli/ui/main_screen.py"
      to: "src/monocli/ui/sections.py"
      via: "focus_table() method call"
---

<objective>
Fix the three major functional bugs in the dashboard UI that prevent core keyboard interaction from working properly.

Purpose: These bugs break fundamental user interactions - opening items with 'o', switching focus with Tab, and quitting with 'q'. They must be fixed for the dashboard to be usable.
Output: Working keyboard navigation and quit functionality across all sections.
</objective>

<execution_context>
@/Users/pg/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/pg/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-dashboard-ui/03-dashboard-ui-UAT.md
@.planning/phases/03-dashboard-ui/03-01-SUMMARY.md
@.planning/phases/03-dashboard-ui/03-02-SUMMARY.md
@.planning/phases/03-dashboard-ui/03-03-SUMMARY.md
@src/monocli/ui/sections.py
@src/monocli/ui/main_screen.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix 'o' key to open items in browser</name>
  <files>src/monocli/ui/sections.py</files>
  <action>
Fix get_selected_url() methods in both MergeRequestSection (around line 334) and WorkItemSection (around line 626).

Current code checks `isinstance(row_key, str)` but DataTable returns RowKey wrapper objects, not strings. The fix is to access `row_key.value` instead of `row_key` directly.

For MergeRequestSection.get_selected_url() (line ~334):
- Change the isinstance check to access row_key.value
- The row_key variable contains the URL string wrapped in a RowKey object

For WorkItemSection.get_selected_url() (line ~626):
- Apply the same fix

Example fix pattern:
```python
# Before:
if isinstance(row_key, str):
    return row_key

# After:
if hasattr(row_key, 'value'):
    return row_key.value
elif isinstance(row_key, str):
    return row_key
```

Or simpler:
```python
# Get the actual string value from RowKey
url = row_key.value if hasattr(row_key, 'value') else row_key
if url:
    return url
```
  </action>
  <verify>Run `grep -n "get_selected_url" src/monocli/ui/sections.py` to confirm both methods exist and check the implementation uses .value accessor</verify>
  <done>Both MergeRequestSection and WorkItemSection get_selected_url() methods properly extract URL from RowKey objects by accessing row_key.value</done>
</task>

<task type="auto">
  <name>Task 2: Fix Tab switching to properly focus tables</name>
  <files>src/monocli/ui/main_screen.py</files>
  <action>
Fix the focus switching bug on line 264 in main_screen.py.

Current code (line 264):
```python
self.work_section.focus()
```

This calls the generic Container.focus() method, which doesn't give focus to the internal DataTable. The WorkItemSection has a focus_table() method that properly focuses the table widget.

Change line 264 from:
```python
self.work_section.focus()
```

To:
```python
self.work_section.focus_table()
```

This ensures that when Tab cycles to the Work Items section, the DataTable inside receives focus so arrow keys work for navigation.
  </action>
  <verify>Run `grep -n "work_section.focus" src/monocli/ui/main_screen.py` to confirm the change uses focus_table()</verify>
  <done>Line 264 calls self.work_section.focus_table() instead of self.work_section.focus()</done>
</task>

<task type="auto">
  <name>Task 3: Add 'q' key binding to quit application</name>
  <files>src/monocli/ui/main_screen.py</files>
  <action>
Add the 'q' quit binding to MainScreen.BINDINGS (around lines 37-42).

Current BINDINGS list is missing the quit action. Add ('q', 'quit', 'Quit') to the list.

Current code (lines 37-42):
```python
BINDINGS = [
    ("tab", "cycle_focus", "Cycle Focus"),
    ("o", "open_selected", "Open"),
    ("j", "move_down", "Down"),
    ("k", "move_up", "Up"),
]
```

Updated code:
```python
BINDINGS = [
    ("tab", "cycle_focus", "Cycle Focus"),
    ("o", "open_selected", "Open"),
    ("j", "move_down", "Down"),
    ("k", "move_up", "Up"),
    ("q", "quit", "Quit"),
]
```

Note: The action_quit() method already exists in app.py (lines 45-47), so only the binding needs to be added to MainScreen.
  </action>
  <verify>Run `grep -n "BINDINGS" src/monocli/ui/main_screen.py` to confirm the 'q' binding is present in the list</verify>
  <done>MainScreen.BINDINGS includes ('q', 'quit', 'Quit') as the last entry</done>
</task>

</tasks>

<verification>
- All 3 major gaps from UAT.md are addressed
- 'o' key opens selected item in browser (gap #4)
- Tab switching properly focuses work items table (gap #5)
- 'q' key quits the application (gap #6)
</verification>

<success_criteria>
1. Pressing 'o' with a selected item opens the browser to that item's URL
2. Pressing Tab cycles through sections and arrow keys work in each focused section
3. Pressing 'q' quits the dashboard and returns to terminal
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-ui/03-04-SUMMARY.md` documenting the fixes for the three major keyboard interaction bugs.
</output>
