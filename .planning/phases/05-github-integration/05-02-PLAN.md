---
phase: 05-github-integration
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/monocli/adapters/__init__.py
  - src/monocli/ui/main_screen.py
  - src/monocli/ui/sections.py
autonomous: true

must_haves:
  truths:
    - "GitHub CLI (gh) is auto-detected on startup alongside glab and acli"
    - "GitHub PRs appear in the Merge Requests section alongside GitLab MRs"
    - "GitHub Issues appear in the Work Items section alongside Jira items"
    - "Missing or unauthenticated gh CLI results in graceful degradation (no crash, other sections still work)"
    - "Dashboard works correctly when only GitHub is available (no glab/acli)"
    - "Dashboard works correctly when both GitHub and GitLab are available"
  artifacts:
    - path: "src/monocli/adapters/__init__.py"
      provides: "GitHubAdapter exported from adapters package"
      contains: "GitHubAdapter"
    - path: "src/monocli/ui/main_screen.py"
      provides: "GitHub data fetching integrated into _fetch_all_data"
      contains: "GitHubAdapter"
    - path: "src/monocli/ui/sections.py"
      provides: "MergeRequestSection handles PullRequest models (not just MergeRequest)"
      contains: "PullRequest"
  key_links:
    - from: "src/monocli/ui/main_screen.py"
      to: "src/monocli/adapters/github.py"
      via: "import and instantiate GitHubAdapter"
      pattern: "from monocli\\.adapters\\.github import GitHubAdapter"
    - from: "src/monocli/ui/main_screen.py"
      to: "src/monocli/ui/sections.py"
      via: "passes GitHub PR/issue data to section widgets"
      pattern: "update_assigned_to_me|update_opened_by_me|update_data"
    - from: "src/monocli/ui/main_screen.py"
      to: "src/monocli/adapters/detection.py"
      via: "registers gh detector"
      pattern: 'CLIDetector\\("gh"'
---

<objective>
Integrate GitHubAdapter into the dashboard so GitHub PRs and Issues appear alongside existing GitLab MRs and Jira work items.

Purpose: This wires the GitHubAdapter (from Plan 01) into the running application. Users with `gh` installed will see GitHub data automatically without any configuration. Users without `gh` see the same dashboard as before — graceful degradation.
Output: Updated `main_screen.py`, `sections.py`, and `adapters/__init__.py` with GitHub integration.
</objective>

<execution_context>
@/Users/pg/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/pg/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-github-integration/05-RESEARCH.md
@.planning/phases/05-github-integration/05-01-SUMMARY.md

# Files being modified:
@src/monocli/ui/main_screen.py
@src/monocli/ui/sections.py
@src/monocli/adapters/__init__.py

# Reference for patterns:
@src/monocli/adapters/github.py
@src/monocli/adapters/detection.py
@src/monocli/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register gh detector and add GitHub fetch methods to MainScreen</name>
  <files>
    src/monocli/adapters/__init__.py
    src/monocli/ui/main_screen.py
  </files>
  <action>
**1. Update `src/monocli/adapters/__init__.py`:**

Add `GitHubAdapter` to the exports:
- Add import: `from monocli.adapters.github import GitHubAdapter`
- Add to `__all__`: `"GitHubAdapter"`

**2. Update `src/monocli/ui/main_screen.py`:**

**Register gh detector** in `detect_and_fetch()`:
Add this line after the existing `acli` registration:
```python
registry.register(CLIDetector("gh", ["auth", "status", "--active"]))
```
Note: Use `--active` flag per research (prevents false negatives with multiple GitHub accounts).

**Add `fetch_github_prs()` method** (mirror `fetch_merge_requests()` pattern):
```python
async def fetch_github_prs(self) -> None:
    """Fetch pull requests from GitHub."""
    from monocli.adapters.github import GitHubAdapter

    adapter = GitHubAdapter()
    if not adapter.is_available():
        return  # Silent skip — gh not installed

    try:
        is_auth = await adapter.check_auth()
        if not is_auth:
            return  # Silent skip — not authenticated

        # Fetch PRs authored by me (GitHub equivalent of GitLab "Opened by me")
        authored_prs = await adapter.fetch_authored_prs()

        # Add GitHub PRs to the MR container
        # GitHub PRs use PullRequest model which has different fields than MergeRequest
        # The sections need to handle both types
        self.mr_container.update_github_authored_prs(authored_prs)
    except Exception:
        pass  # Silent fail — don't disrupt other sections
```

**Add `fetch_github_issues()` method** (mirror `fetch_work_items()` pattern):
```python
async def fetch_github_issues(self) -> None:
    """Fetch issues from GitHub."""
    from monocli.adapters.github import GitHubAdapter

    adapter = GitHubAdapter()
    if not adapter.is_available():
        return  # Silent skip

    try:
        is_auth = await adapter.check_auth()
        if not is_auth:
            return  # Silent skip

        issues = await adapter.fetch_assigned_issues()
        self.work_section.update_github_issues(issues)
    except Exception:
        pass  # Silent fail
```

**Update `_fetch_all_data()`** to include GitHub fetches:
Add `self.fetch_github_prs()` and `self.fetch_github_issues()` to the `asyncio.gather()` call:
```python
async def _fetch_all_data(self) -> None:
    await asyncio.gather(
        self.fetch_merge_requests(),
        self.fetch_work_items(),
        self.fetch_github_prs(),
        self.fetch_github_issues(),
        return_exceptions=True,
    )
```

**IMPORTANT design choice for graceful degradation:** GitHub fetch methods use silent `return` on unavailable/unauthenticated (not `set_error()`). This is because the MR and Work Item sections are already being populated by GitLab/Jira. If GitHub is also available, its data gets added. If not, the existing sections still show GitLab/Jira data. This is additive behavior, not exclusive.
  </action>
  <verify>
Run: `uv run ruff check src/monocli/adapters/__init__.py src/monocli/ui/main_screen.py && uv run ruff format --check src/monocli/adapters/__init__.py src/monocli/ui/main_screen.py`
Verify: No lint or format errors.
Run: `uv run python -c "from monocli.adapters import GitHubAdapter; print('GitHubAdapter imported successfully')"` 
Verify: Prints success message.
  </verify>
  <done>
- `gh` detector registered in detect_and_fetch() alongside glab and acli
- fetch_github_prs() and fetch_github_issues() methods added to MainScreen
- _fetch_all_data() runs all 4 fetches concurrently (GitLab MRs, Jira items, GitHub PRs, GitHub Issues)
- Graceful degradation: missing/unauthenticated gh silently skipped, other data sources unaffected
- GitHubAdapter exported from adapters package __init__.py
  </done>
</task>

<task type="auto">
  <name>Task 2: Update UI sections to display GitHub PRs and Issues alongside existing data</name>
  <files>src/monocli/ui/sections.py</files>
  <action>
The MergeRequestSection currently expects `MergeRequest` models (GitLab). It needs to also handle `PullRequest` models (GitHub). Similarly, WorkItemSection needs to handle `GitHubIssue` models alongside `JiraWorkItem` models.

**Update MergeRequestSection to handle PullRequest models:**

The existing `update_data(merge_requests: list[MergeRequest])` renders rows using GitLab-specific fields (`source_branch`, `web_url`, `author.get("name")`). GitHub's `PullRequest` model has different fields (`html_url`, `author.get("login")`, no `source_branch`).

Strategy: Keep `update_data()` for GitLab MRs, but make it accept a union type, or create a helper that can render either type. The simplest approach:

Add `TYPE_CHECKING` import for `PullRequest`:
```python
if TYPE_CHECKING:
    from monocli.models import JiraWorkItem, MergeRequest, PullRequest, GitHubIssue
```

In `MergeRequestSection`, add rendering logic that detects the model type. Modify the row-rendering in `update_data()` to handle both:
- For `MergeRequest`: use `mr.author.get("name") or mr.author.get("username")`, `mr.source_branch`, `str(mr.web_url)` as row key
- For `PullRequest`: use `mr.author.get("login")`, show "—" for branch (PRs from search don't have branch info), `str(mr.html_url)` as row key

The cleanest implementation: change `update_data()` to accept `list[MergeRequest | PullRequest]` (using `Any` for runtime) and use `hasattr` to detect which model type each item is:

```python
def update_data(self, items: list) -> None:
    # ... clear table, check empty ...
    for item in items:
        if hasattr(item, 'source_branch'):
            # GitLab MergeRequest
            author = item.author.get("name") or item.author.get("username") or "Unknown"
            branch = item.source_branch
            url = str(item.web_url)
        else:
            # GitHub PullRequest
            author = item.author.get("login") or "Unknown"
            branch = "—"
            url = str(item.html_url)
        
        created = self._format_date(item.created_at)
        self._data_table.add_row(
            item.display_key(),
            self._truncate_title(item.title),
            item.display_status(),
            author,
            branch,
            created,
            key=url,
        )
```

**Update MergeRequestContainer to accumulate GitHub PRs:**

Add method `update_github_authored_prs(prs: list)`:
- Store GitHub PRs internally
- Append them to the "Opened by me" subsection (since these are PRs authored by @me)
- Call `self.opened_by_me_section.update_data()` with the combined list (existing GitLab authored MRs + GitHub authored PRs)

To support additive behavior, MergeRequestContainer needs to track data from both sources:
- Add `self._gitlab_opened: list = []` and `self._github_authored: list = []` in `__init__`
- Modify `update_opened_by_me()` to store `self._gitlab_opened = merge_requests` then call `self.opened_by_me_section.update_data(self._gitlab_opened + self._github_authored)`
- Add `update_github_authored_prs()` to store `self._github_authored = prs` then call `self.opened_by_me_section.update_data(self._gitlab_opened + self._github_authored)`
- `update_assigned_to_me()` stays as-is (GitHub search doesn't have an "assigned PRs" concept via `gh search prs`, since `--assignee` isn't available for PR search)

**Update WorkItemSection to handle GitHubIssue models:**

Similar strategy. Add additive method `update_github_issues(issues: list[GitHubIssue])`:
- Store GitHub issues internally: `self._github_issues: list = []`
- Store Jira items internally: `self._jira_items: list = []` 
- Modify existing `update_data()` to store `self._jira_items = work_items` then render combined
- Add `update_github_issues()` to store and re-render combined

The combined render needs to handle both model types in the row loop:
```python
for item in all_items:
    if hasattr(item, 'key'):
        # JiraWorkItem
        assignee = item.assignee or "Unassigned"
        url = item.url
        self._data_table.add_row(
            item.display_key(), self._truncate_title(item.summary),
            item.display_status(), item.priority, assignee, "",
            key=url,
        )
    else:
        # GitHubIssue
        labels = ", ".join(item.labels[:3]) if item.labels else "—"
        url = str(item.html_url)
        self._data_table.add_row(
            item.display_key(), self._truncate_title(item.title),
            item.display_status(), labels, item.author.get("login", "Unknown"),
            self._format_date(item.created_at),
            key=url,
        )
```

Note: For GitHub Issues, the "Priority" column shows labels (first 3) and "Assignee" column shows author login. This reuses existing columns without adding new ones.

**CRITICAL:** The `get_selected_url()` methods in both sections already use the `key` parameter from `add_row()` to retrieve URLs. As long as we store the correct URL in `key=`, browser opening will work for both GitHub and GitLab items.
  </action>
  <verify>
Run: `uv run ruff check src/monocli/ui/sections.py && uv run ruff format --check src/monocli/ui/sections.py`
Verify: No lint or format errors.
Run: `uv run pytest` — full test suite passes.
Run: `uv run python -m monocli` (if gh is installed and authenticated, GitHub PRs/Issues should appear; if not, dashboard should work normally with just GitLab/Jira data)
  </verify>
  <done>
- MergeRequestSection renders both MergeRequest (GitLab) and PullRequest (GitHub) models
- MergeRequestContainer accumulates PRs from both sources in "Opened by me" subsection
- WorkItemSection renders both JiraWorkItem and GitHubIssue models
- URL-based row keys work for both GitHub and GitLab items (browser opening works)
- All existing tests pass (no regressions)
  </done>
</task>

</tasks>

<verification>
1. `uv run ruff check src/monocli/adapters/__init__.py src/monocli/ui/main_screen.py src/monocli/ui/sections.py` — no lint errors
2. `uv run ruff format --check src/monocli/adapters/__init__.py src/monocli/ui/main_screen.py src/monocli/ui/sections.py` — properly formatted  
3. `uv run pytest` — full test suite passes (no regressions)
4. `uv run python -c "from monocli.adapters import GitHubAdapter; print('OK')"` — import works
5. Manual smoke test: `uv run python -m monocli` — dashboard loads, shows GitHub data if gh available
</verification>

<success_criteria>
- gh detector registered alongside glab and acli in detect_and_fetch()
- GitHub PRs appear in "Opened by me" section when gh CLI is available and authenticated
- GitHub Issues appear in Work Items section when gh CLI is available and authenticated
- Dashboard works when only GitLab available (no gh) — no errors, no crashes
- Dashboard works when only GitHub available (no glab) — no errors, no crashes
- Dashboard works when both available — data from both sources displayed
- Browser opening (o key) works for GitHub URLs (PRs and Issues)
- All existing tests pass without modification
</success_criteria>

<output>
After completion, create `.planning/phases/05-github-integration/05-02-SUMMARY.md`
</output>
